!function(editors,elFinder){if("function"==typeof define&&define.amd)define(["elfinder"],editors);else if(elFinder){var optEditors=elFinder.prototype._options.commandsOptions.edit.editors;elFinder.prototype._options.commandsOptions.edit.editors=optEditors.concat(editors(elFinder))}}((function(elFinder){"use strict";var getfile=window.location.search.match(/getfile=([a-z]+)/),useRequire=elFinder.prototype.hasRequire,hasFlash=function(){var hasFlash;try{hasFlash=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){hasFlash=!!(void 0===window.orientation||navigator&&navigator.mimeTypes["application/x-shockwave-flash"])}return hasFlash}(),ext2mime={bmp:"image/x-ms-bmp",dng:"image/x-adobe-dng",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",pdf:"application/pdf",png:"image/png",ppm:"image/x-portable-pixmap",psd:"image/vnd.adobe.photoshop",pxd:"image/x-pixlr-data",svg:"image/svg+xml",tiff:"image/tiff",webp:"image/webp",xcf:"image/x-xcf",sketch:"application/x-sketch"},mime2ext,getExtention=function(mime,fm){mime2ext||(mime2ext=fm.arrayFlip(ext2mime));var ext=mime2ext[mime]||fm.mimeTypes[mime];return"jpeg"===ext&&(ext="jpg"),ext},changeImageType=function(src,toMime){var dfd=$.Deferred();try{var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),img=new Image,conv=function(){var url,mime,m;(mime=(m=canvas.toDataURL(toMime).match(/^data:([a-z0-9]+\/[a-z0-9.+-]+)/i))?m[1]:"").toLowerCase()===toMime.toLowerCase()?dfd.resolve(canvas.toDataURL(toMime),canvas):dfd.reject()};return img.src=src,$(img).on("load",(function(){try{canvas.width=img.width,canvas.height=img.height,ctx.drawImage(img,0,0),conv()}catch(e){dfd.reject()}})).on("error",(function(){dfd.reject()})),dfd}catch(e){return dfd.reject()}},initImgTag=function(id,file,content,fm){var node=$(this).children("img:first").data("ext",getExtention(file.mime,fm)),spnr=$('<div class="elfinder-edit-spinner elfinder-edit-image"/>').html('<span class="elfinder-spinner-text">'+fm.i18n("ntfloadimg")+'</span><span class="elfinder-spinner"/>').hide().appendTo(this),url;content.match(/^data:/)||(url=fm.openUrl(file.hash),node.attr("_src",content)),node.attr("id",id+"-img").attr("src",url||content).css({height:"","max-width":"100%","max-height":"100%",cursor:"pointer"}).data("loading",(function(done){var btns;return node.closest(".elfinder-dialog").find("button,.elfinder-titlebar-button").prop("disabled",!done)[done?"removeClass":"addClass"]("ui-state-disabled"),node.css("opacity",done?"":"0.3"),spnr[done?"hide":"show"](),node}))},imgBase64=function(node,mime){var style=node.attr("style"),img,canvas,ctx,data;try{node.attr("style",""),img=node.get(0),(canvas=document.createElement("canvas")).width=img.width,canvas.height=img.height,node.attr("style",style),canvas.getContext("2d").drawImage(img,0,0),data=canvas.toDataURL(mime)}catch(e){data=node.attr("src")}return data},pixlrCallBack,pixlrSetup=function(opts,fm){hasFlash&&!fm.UA.ltIE8||(this.disabled=!0)},pixlrLoad=function(mode,base){var self=this,fm=this.fm,clPreventBack=fm.res("class","preventback"),node=$(base).children("img:first").data("loading")().data("resizeoff",(function(){return $(window).off("resize."+node.attr("id")),dialog.addClass(clPreventBack),node})).on("click",(function(){launch()})),dialog=$(base).closest(".ui-dialog"),elfNode=fm.getUI(),uiToast=fm.getUI("toast"),container=$('<iframe class="ui-front" allowtransparency="true">'),file=this.file,timeout=15,error=function(error){error?(container.trigger("destroy").remove(),node.data("loading")(!0),fm.error(error)):(uiToast.appendTo(dialog.closest(".ui-dialog")),fm.toast({mode:"info",msg:"Can not launch Pixlr yet. Waiting 15 seconds.",button:{text:"Abort",click:function(){container.trigger("destroy").remove(),node.data("loading")(!0)}},onHidden:function(){1===uiToast.children().length&&uiToast.appendTo(fm.getUI())}}),errtm=setTimeout(error,15e3))},launch=function(){var src="https://pixlr.com/"+mode+"/?s=c",myurl=window.location.href.toString().replace(/#.*$/,""),opts={};errtm=setTimeout(error,15e3),myurl+=(-1===myurl.indexOf("?")?"?":"&")+"pixlr="+node.attr("id"),src+="&referrer=elFinder&locktitle=true",src+="&exit="+encodeURIComponent(myurl+"&image=0"),src+="&target="+encodeURIComponent(myurl),src+="&title="+encodeURIComponent(file.name),src+="&image="+encodeURIComponent(node.attr("_src")),opts.src=src,opts.css={width:"100%",height:$(window).height()+"px",position:"fixed",display:"block",backgroundColor:"transparent",border:"none",top:0,right:0},self.trigger("Prepare",{node:base,editorObj:void 0,instance:container,opts:opts}),container.attr("id",node.attr("id")+"iframe").attr("src",opts.src).css(opts.css).one("load",(function(){errtm&&clearTimeout(errtm),setTimeout((function(){container.is(":hidden")&&error("Please disable your ad blocker.")}),1e3),dialog.addClass(clPreventBack),fm.toggleMaximize(container,!0),fm.toFront(container)})).on("destroy",(function(){fm.toggleMaximize(container,!1)})).on("error",error).appendTo(elfNode.hasClass("elfinder-fullscreen")?elfNode:"body")},errtm;$(base).on("saveAsFail",launch),launch()},iframeClose=function(ifm){var $ifm=$(ifm),dfd=$.Deferred().always((function(){$ifm.off("load",load)})),ab="about:blank",chk=function(){tm=setTimeout((function(){var src;try{src=base.contentWindow.location.href}catch(e){src=null}src===ab?dfd.resolve():--cnt>0?chk():dfd.reject()}),500)},load=function(){tm&&clearTimeout(tm),dfd.resolve()},cnt=20,tm;return $ifm.one("load",load),ifm.src=ab,chk(),dfd};return function(){if(hasFlash&&window.parent!==window){var pixlr=window.location.search.match(/[?&]pixlr=([^&]+)/),image=window.location.search.match(/[?&]image=([^&]+)/),p,ifm,url,node,ext;pixlr&&(ifm=(p=window.parent).$("#"+pixlr[1]+"iframe").hide(),node=p.$("#"+pixlr[1]).data("resizeoff")(),"http"===image[1].substr(0,4)?(ext=(url=image[1]).replace(/.+\.([^.]+)$/,"$1"),node.data("ext")!==ext&&node.closest(".ui-dialog").trigger("changeType",{extention:ext,mime:ext2mime[ext]}),"https:"===window.location.protocol&&(url=url.replace(/^http:/,"https:")),node.on("load error",(function(){node.data("loading")(!0)})).attr("src",url).data("loading")()):node.data("loading")(!0),ifm.trigger("destroy").remove())}}(),getfile&&"ckeditor"===(getfile=getfile[1])&&(elFinder.prototype._options.getFileCallback=function(file,fm){var reParam,match;window.opener.CKEDITOR.tools.callFunction((reParam=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),(match=window.location.search.match(reParam))&&match.length>1?match[1]:""),fm.convAbsUrl(file.url)),fm.destroy(),window.close()}),[{info:{id:"tuiimgedit",name:"TUI Image Editor",iconImg:"img/editor-icons.png 0 -48",dataScheme:!0,schemeContent:!0,openMaximized:!0,canMakeEmpty:!1,integrate:{title:"TOAST UI Image Editor",link:"http://ui.toast.com/tui-image-editor/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><canvas></canvas></div>',setup:function(opts,fm){fm.UA.ltIE8||fm.UA.Mobile?this.disabled=!0:(this.opts=Object.assign({version:"v3.7.0"},opts.extraOptions.tuiImgEditOpts||{},{iconsPath:fm.baseUrl+"img/tui-",theme:{}}),fm.isSameOrigin(this.opts.iconsPath)||(this.disabled=!0,fm.debug("warning","Setting `commandOptions.edit.extraOptions.tuiImgEditOpts.iconsPath` MUST follow the same origin policy.")))},init:function(id,file,content,fm){this.data("url",content)},load:function(base){var self=this,fm=this.fm,dfrd=$.Deferred(),cdns=fm.options.cdns,ver=self.confObj.opts.version,init=function(editor){var $base=$(base),bParent=$base.parent(),opts=self.confObj.opts,iconsPath=opts.iconsPath,tmpContainer=$('<div class="tui-image-editor-container">').appendTo(bParent),tmpDiv=[$('<div class="tui-image-editor-submenu"/>').appendTo(tmpContainer),$('<div class="tui-image-editor-controls"/>').appendTo(tmpContainer)],iEditor=new editor(base,{includeUI:{loadImage:{path:$base.data("url"),name:self.file.name},theme:Object.assign(opts.theme,{"menu.normalIcon.path":iconsPath+"icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":iconsPath+"icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":iconsPath+"icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":iconsPath+"icon-c.svg","menu.hoverIcon.name":"icon-c","submenu.normalIcon.path":iconsPath+"icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":iconsPath+"icon-c.svg","submenu.activeIcon.name":"icon-c"}),initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:Math.max(300,bParent.width()),cssMaxHeight:Math.max(200,bParent.height()-(tmpDiv[0].height()+tmpDiv[1].height()+3)),usageStatistics:!1}),canvas=$base.find("canvas:first").get(0),zoom=function(v){if(void 0!==v){var c=$(canvas),w=parseInt(c.attr("width")),h=parseInt(c.attr("height")),a=w/h,mw,mh;0===v?(mw=w,mh=h):(mh=(mw=parseInt(c.css("max-width"))+Number(v))/a,mw>w&&mh>h&&(mw=w,mh=h)),per.text(Math.round(mw/w*100)+"%"),iEditor.resizeCanvasDimension({width:mw,height:mh}),zoomMore&&setTimeout((function(){zoomMore&&zoom(v)}),50)}},zup=$('<span class="ui-icon ui-icon-plusthick"/>').data("val",10),zdown=$('<span class="ui-icon ui-icon-minusthick"/>').data("val",-10),per=$("<button/>").css("width","4em").text("%").attr("title","100%").data("val",0),quty,qutyTm,zoomTm,zoomMore;tmpContainer.remove(),$base.removeData("url").data("mime",self.file.mime),"image/jpeg"===self.file.mime?($base.data("quality",fm.storage("jpgQuality")||fm.option("jpgQuality")),quty=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",(function(){var q=quty.val();$base.data("quality",q),qutyTm&&cancelAnimationFrame(qutyTm),qutyTm=requestAnimationFrame((function(){canvas.toBlob((function(blob){blob&&quty.next("span").text(" ("+fm.formatSize(blob.size)+")")}),"image/jpeg",Math.max(Math.min(q,100),1)/100)}))})).val($base.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(fm.i18n("quality")+" : "),quty,$("<span/>")).prependTo($base.parent().next())):"image/svg+xml"===self.file.mime&&$base.closest(".ui-dialog").trigger("changeType",{extention:"png",mime:"image/png",keepEditor:!0}),$('<div class="ui-dialog-buttonset elfinder-edit-extras"/>').append(zdown,per,zup).attr("title",fm.i18n("scale")).on("click","span,button",(function(){zoom($(this).data("val"))})).on("mousedown mouseup mouseleave","span",(function(e){zoomMore=!1,zoomTm&&clearTimeout(zoomTm),"mousedown"===e.type&&(zoomTm=setTimeout((function(){zoomMore=!0,zoom($(e.target).data("val"))}),500))})).prependTo($base.parent().next()),setTimeout((function(){dfrd.resolve(iEditor),quty&&(quty.trigger("change"),iEditor.on("redoStackChanged undoStackChanged",(function(){quty.trigger("change")}))),zoom(null)}),100)},loader;return self.confObj.editor?init(self.confObj.editor):(loader=$.Deferred(),fm.loadCss([cdns.tui+"/tui-color-picker/latest/tui-color-picker.css",cdns.tui+"/tui-image-editor/"+ver+"/tui-image-editor.css"]),fm.hasRequire?(require.config({paths:{"fabric/dist/fabric.require":cdns.fabric+"/fabric.require.min",fabric:cdns.fabric+"/fabric.min","tui-code-snippet":cdns.tui+"/tui.code-snippet/latest/tui-code-snippet.min","tui-color-picker":cdns.tui+"/tui-color-picker/latest/tui-color-picker.min","tui-image-editor":cdns.tui+"/tui-image-editor/"+ver+"/tui-image-editor.min"}}),require(["tui-image-editor"],(function(ImageEditor){loader.resolve(ImageEditor)}))):fm.loadScript([cdns.fabric+"/fabric.min.js",cdns.tui+"/tui.code-snippet/latest/tui-code-snippet.min.js"],(function(){fm.loadScript([cdns.tui+"/tui-color-picker/latest/tui-color-picker.min.js"],(function(){fm.loadScript([cdns.tui+"/tui-image-editor/"+ver+"/tui-image-editor.min.js"],(function(){loader.resolve(window.tui.ImageEditor)}),{loadType:"tag"})}),{loadType:"tag"})}),{loadType:"tag"}),loader.done((function(editor){self.confObj.editor=editor,init(editor)}))),dfrd},getContent:function(base){var editor=this.editor,fm=editor.fm,$base=$(base),quality=$base.data("quality");if(editor.instance)return"image/jpeg"===$base.data("mime")&&(quality=quality||fm.storage("jpgQuality")||fm.option("jpgQuality"),quality=Math.max(.1,Math.min(1,quality/100))),editor.instance.toDataURL({format:getExtention($base.data("mime"),fm),quality:quality})},save:function(base){var $base=$(base),quality=$base.data("quality"),hash=$base.data("hash"),file;this.instance.deactivateAll(),void 0!==quality&&this.fm.storage("jpgQuality",quality),hash&&(file=this.fm.file(hash),$base.data("mime",file.mime))}},{info:{id:"pixlreditor",name:"Pixlr Editor",iconImg:"img/editor-icons.png 0 -128",urlAsContent:!0,schemeContent:!0,single:!0,canMakeEmpty:!0,integrate:{title:"PIXLR EDITOR",link:"https://pixlr.com/editor/"}},mimes:["image/jpeg","image/png","image/gif","image/x-ms-bmp","image/x-pixlr-data"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(opts,fm){pixlrSetup.call(this,opts,fm)},init:function(id,file,url,fm){initImgTag.call(this,id,file,file.size>0?fm.convAbsUrl(url):"",fm)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(base){pixlrLoad.call(this,"editor",base)},save:function(base){},close:function(base){}},{info:{id:"pixlrexpress",name:"Pixlr Express",iconImg:"img/editor-icons.png 0 -112",urlAsContent:!0,schemeContent:!0,single:!0,canMakeEmpty:!1,integrate:{title:"PIXLR EXPRESS",link:"https://pixlr.com/express/"}},mimes:["image/jpeg","image/png","image/gif"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(opts,fm){pixlrSetup.call(this,opts,fm)},init:function(id,file,url,fm){initImgTag.call(this,id,file,file.size>0?fm.convAbsUrl(url):"",fm)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(base){pixlrLoad.call(this,"express",base)},save:function(base){},close:function(base){}},{info:{id:"photopea",name:"Photopea",iconImg:"img/editor-icons.png 0 -160",single:!0,noContent:!0,arrayBufferContent:!0,openMaximized:!0,canMakeEmpty:["image/jpeg","image/png","image/gif","image/x-ms-bmp","image/tiff","image/webp","image/vnd.adobe.photoshop","image/x-portable-pixmap","image/x-sketch"],integrate:{title:"Photopea",link:"https://www.photopea.com/learn/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/tiff","image/x-adobe-dng","image/webp","image/x-xcf","image/vnd.adobe.photoshop","application/pdf","image/x-portable-pixmap","image/x-sketch"],html:'<iframe style="width:100%;height:100%;border:none;"></iframe>',setup:function(opts,fm){(fm.UA.IE||fm.UA.Mobile)&&(this.disabled=!0)},init:function(id,file,dum,fm){var orig="https://www.photopea.com",ifm=$(this).hide().on("load",(function(){ifm.show()})).on("error",(function(){spnr.remove(),ifm.show()})),editor=this.editor,confObj=editor.confObj,spnr=$('<div class="elfinder-edit-spinner elfinder-edit-photopea"/>').html('<span class="elfinder-spinner-text">'+fm.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(ifm.parent()),saveMimes=fm.arrayFlip(confObj.info.canMakeEmpty),getType=function(mime){var ext=getExtention(mime,fm),extmime=ext2mime[ext];return confObj.mimesFlip[extmime]?"jpeg"===ext&&(ext="jpg"):ext="",ext&&!saveMimes[ext]||(extmime=ext2mime[ext="psd"],ifm.closest(".ui-dialog").trigger("changeType",{extention:ext,mime:extmime,keepEditor:!0})),ext},mime=file.mime,liveMsg,type,quty;confObj.mimesFlip||(confObj.mimesFlip=fm.arrayFlip(confObj.mimes,!0)),confObj.liveMsg||(confObj.liveMsg=function(ifm,spnr,file){var url=fm.openUrl(file.hash);fm.isSameOrigin(url)||(url=fm.openUrl(file.hash,!0));var wnd=ifm.get(0).contentWindow,phase=0,data=null,dfdIni=$.Deferred().done((function(){spnr.remove(),phase=1,wnd.postMessage(data,"*")})),dfdGet;this.load=function(){return fm.request({data:{cmd:"get"},options:{url:url,type:"get",cache:!0,dataType:"binary",responseType:"arraybuffer",processData:!1}}).done((function(d){data=d}))},this.receive=function(e){var ev=e.originalEvent,state;ev.origin===orig&&ev.source===wnd&&("done"===ev.data?0===phase?dfdIni.resolve():1===phase?(phase=2,ifm.trigger("contentsloaded")):dfdGet&&"pending"===dfdGet.state()&&dfdGet.reject("errDataEmpty"):dfdGet&&"pending"===dfdGet.state()&&("object"==typeof ev.data?dfdGet.resolve("data:"+mime+";base64,"+fm.arrayBufferToBase64(ev.data)):dfdGet.reject("errDataEmpty")))},this.getContent=function(){var type,q;if(phase>1)return dfdGet&&"pending"===dfdGet.state()&&dfdGet.reject(),dfdGet=null,dfdGet=$.Deferred(),2===phase?(phase=3,dfdGet.resolve("data:"+mime+";base64,"+fm.arrayBufferToBase64(data)),data=null,dfdGet):(ifm.data("mime")&&(mime=ifm.data("mime"),type=getType(mime)),(q=ifm.data("quality"))&&(type+=":"+q/100),wnd.postMessage('app.activeDocument.saveToOE("'+type+'")',orig),dfdGet)}}),ifm.parent().css("padding",0),type=getType(file.mime),liveMsg=editor.liveMsg=new confObj.liveMsg(ifm,spnr,file),$(window).on("message."+fm.namespace,liveMsg.receive),liveMsg.load().done((function(){var d=JSON.stringify({files:[],environment:{lang:fm.lang.replace(/_/g,"-")}});ifm.attr("src",orig+"/#"+encodeURI(d))})).fail((function(err){err&&fm.error(err),editor.initFail=!0})),"image/jpeg"!==file.mime&&"image/webp"!==file.mime||(ifm.data("quality",fm.storage("jpgQuality")||fm.option("jpgQuality")),quty=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",(function(){var q=quty.val();ifm.data("quality",q)})).val(ifm.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(fm.i18n("quality")+" : "),quty,$("<span/>")).prependTo(ifm.parent().next()))},load:function(base){var dfd=$.Deferred(),self=this,fm=this.fm,$base=$(base);return self.initFail?dfd.reject():$base.on("contentsloaded",(function(){dfd.resolve(self.liveMsg)})),dfd},getContent:function(){return this.editor.liveMsg?this.editor.liveMsg.getContent():void 0},save:function(base,liveMsg){var $base=$(base),quality=$base.data("quality"),hash=$base.data("hash"),file;void 0!==quality&&this.fm.storage("jpgQuality",quality),hash?(file=this.fm.file(hash),$base.data("mime",file.mime)):$base.removeData("mime")},close:function(base,liveMsg){$(base).attr("src",""),liveMsg&&$(window).off("message."+this.fm.namespace,liveMsg.receive)}},{info:{id:"pixo",name:"Pixo Editor",iconImg:"img/editor-icons.png 0 -208",dataScheme:!0,schemeContent:!0,single:!0,canMakeEmpty:!1,integrate:{title:"Pixo Editor",link:"https://pixoeditor.com/privacy-policy/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(opts,fm){!fm.UA.ltIE8&&opts.extraOptions&&opts.extraOptions.pixo&&opts.extraOptions.pixo.apikey?this.editorOpts=opts.extraOptions.pixo:this.disabled=!0},init:function(id,file,content,fm){initImgTag.call(this,id,file,content,fm)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(base){var self=this,fm=this.fm,$base=$(base),node=$base.children("img:first"),dialog=$base.closest(".ui-dialog"),elfNode=fm.getUI(),dfrd=$.Deferred(),container=$("#elfinder-pixo-container"),init=function(onload){var opts;container.length?container.appendTo(container.parent()):(container=$('<div id="elfinder-pixo-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"hidden"}).hide().appendTo(elfNode.hasClass("elfinder-fullscreen")?elfNode:"body"),elfNode.on("resize."+fm.namespace,(function(e,data){e.preventDefault(),e.stopPropagation(),data&&data.fullscreen&&container.appendTo("on"===data.fullscreen?elfNode:"body")})),fm.bind("destroy",(function(){editor&&editor.cancelEditing(),container.remove()}))),node.on("click",launch),opts=Object.assign({type:"child",parent:container.get(0),output:{format:"png"},onSave:function(arg){var mime=arg.toBlob().type,ext=getExtention(mime,fm),draw=function(url){node.one("load error",(function(){node.data("loading")&&node.data("loading")(!0)})).attr("crossorigin","anonymous").attr("src",url)},url=arg.toDataURL();node.data("loading")(),delete base._canvas,node.data("ext")!==ext?changeImageType(url,self.file.mime).done((function(res,cv){cv&&(base._canvas=canvas=cv,quty.trigger("change"),qBase&&qBase.show()),draw(res)})).fail((function(){dialog.trigger("changeType",{extention:ext,mime:mime}),draw(url)})):draw(url)},onClose:function(){dialog.removeClass(fm.res("class","preventback")),fm.toggleMaximize(container,!1),container.hide(),fm.toFront(dialog)}},self.confObj.editorOpts),self.trigger("Prepare",{node:base,editorObj:Pixo,instance:void 0,opts:opts}),editor=new Pixo.Bridge(opts),dfrd.resolve(editor),$base.on("saveAsFail",launch),onload&&onload()},launch=function(){dialog.addClass(fm.res("class","preventback")),fm.toggleMaximize(container,!0),fm.toFront(container),container.show().data("curhash",self.file.hash),editor.edit(node.get(0)),node.data("loading")(!0)},qBase,quty,qutyTm,canvas,editor;return node.data("loading")(),"image/jpeg"===self.file.mime&&(quty=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",(function(){var q=quty.val();qutyTm&&cancelAnimationFrame(qutyTm),qutyTm=requestAnimationFrame((function(){canvas&&canvas.toBlob((function(blob){blob&&quty.next("span").text(" ("+fm.formatSize(blob.size)+")")}),"image/jpeg",Math.max(Math.min(q,100),1)/100)}))})).val(fm.storage("jpgQuality")||fm.option("jpgQuality")),qBase=$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').hide().append($("<span>").html(fm.i18n("quality")+" : "),quty,$("<span/>")).prependTo($base.parent().next()),$base.data("quty",quty)),"undefined"==typeof Pixo?fm.loadScript(["https://pixoeditor.com:8443/editor/scripts/bridge.m.js"],(function(){init(launch)}),{loadType:"tag"}):(init(),launch()),dfrd},save:function(base){var self=this,$base=$(base),node=$base.children("img:first"),q;base._canvas?($base.data("quty")&&(q=$base.data("quty").val())&&this.fm.storage("jpgQuality",q),node.attr("src",base._canvas.toDataURL(this.file.mime,q?Math.max(Math.min(q,100),1)/100:void 0))):"data:"!==node.attr("src").substr(0,5)&&node.attr("src",imgBase64(node,this.file.mime))},close:function(base,editor){editor&&editor.destroy()}},{info:{id:"creativecloud",name:"Creative Cloud",iconImg:"img/editor-icons.png 0 -192",dataScheme:!0,schemeContent:!0,single:!0,canMakeEmpty:!1,integrate:{title:"Adobe Creative Cloud",link:"https://www.adobe.io/apis/creativecloud.html"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(opts,fm){!fm.UA.ltIE8&&opts.extraOptions&&opts.extraOptions.creativeCloudApiKey?this.apiKey=opts.extraOptions.creativeCloudApiKey:this.disabled=!0},init:function(id,file,content,fm){initImgTag.call(this,id,file,content,fm)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(base){var self=this,fm=this.fm,$base=$(base),node=$base.children("img:first"),dialog=$base.closest(".ui-dialog"),elfNode=fm.getUI(),dfrd=$.Deferred(),container=$("#elfinder-aviary-container"),init=function(onload){var getLang=function(){var langMap={zh_TW:"zh_HANT",zh_CN:"zh_HANS"};return langMap[fm.lang]?langMap[fm.lang]:fm.lang},opts;container.length?container.appendTo(container.parent()):(container=$('<div id="elfinder-aviary-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"auto"}).hide().appendTo(elfNode.hasClass("elfinder-fullscreen")?elfNode:"body"),elfNode.on("resize."+fm.namespace,(function(e,data){e.preventDefault(),e.stopPropagation(),data&&data.fullscreen&&container.appendTo("on"===data.fullscreen?elfNode:"body")})),fm.bind("destroy",(function(){container.remove()}))),node.on("click",launch).data("loading")(),opts={apiKey:self.confObj.apiKey,onSave:function(imageID,newURL){var noChange=fm.arrayFlip(["jpg","png"]),ext;featherEditor.showWaitIndicator(),ext=newURL.replace(/.+\.([^.]+)$/,"$1"),noChange[node.data("ext")]||node.data("ext")===ext?node.data("mime",ext2mime[node.data("ext")]):(node.closest(".ui-dialog").trigger("changeType",{extention:ext,mime:ext2mime[ext]}),node.data("mime",ext2mime[ext])),node.on("load error",(function(){var cavImg;node.data("loading")(!0),quty&&"data:"!==node.attr("src").substr(0,5)&&(cavImg=document.createElement("img"),$(cavImg).attr("crossorigin","anonymous").on("load",(function(){(canvas=document.createElement("canvas")).width=cavImg.width,canvas.height=cavImg.height,canvas.getContext("2d").drawImage(cavImg,0,0),base._canvas=canvas,quty&&quty.trigger("change")})),cavImg.src=newURL)})).attr("crossorigin","anonymous").attr("src",newURL).data("loading")(),featherEditor.close()},onLoad:onload||function(){},onClose:function(){dialog.removeClass(fm.res("class","preventback")),fm.toggleMaximize(container,!1),$(container).hide()},appendTo:container.get(0),maxSize:2048,language:getLang(),fileFormat:"png"},self.trigger("Prepare",{node:base,editorObj:Aviary,instance:void 0,opts:opts}),featherEditor=new Aviary.Feather(opts),dfrd.resolve(featherEditor),$base.on("saveAsFail",launch)},launch=function(){dialog.addClass(fm.res("class","preventback")),fm.toggleMaximize(container,!0),fm.toFront(container),$(container).show(),featherEditor.launch({image:node.attr("id"),url:node.attr("src")}),node.data("loading")(!0)},featherEditor,extraOpts,canvas,quty,qutyTm;return"image/jpeg"===self.file.mime&&($base.data("quality",fm.storage("jpgQuality")||fm.option("jpgQuality")),quty=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",(function(){var q=quty.val();$base.data("quality",q),qutyTm&&cancelAnimationFrame(qutyTm),canvas&&(qutyTm=requestAnimationFrame((function(){canvas.toBlob((function(blob){blob&&quty.next("span").text(" ("+fm.formatSize(blob.size)+")")}),"image/jpeg",Math.max(Math.min(q,100),1)/100)})))})).val($base.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(fm.i18n("quality")+" : "),quty,$("<span/>")).prependTo($base.parent().next())),"undefined"==typeof Aviary?fm.loadScript(["https://dme0ih8comzn4.cloudfront.net/imaging/v3/editor.js"],(function(){init(launch)}),{loadType:"tag"}):(init(),launch()),dfrd},save:function(base){var node=$(base).children("img:first"),q=$(base).data("quality");base._canvas?(q&&this.fm.storage("jpgQuality",q),node.attr("src",base._canvas.toDataURL(node.data("mime"),q?Math.max(Math.min(q,100),1)/100:void 0))):"data:"!==node.attr("src").substr(0,5)&&node.attr("src",imgBase64(node,node.data("mime")))}},{setup:function(opts,fm){!fm.UA.ltIE8&&fm.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"ACE Editor",iconImg:"img/editor-icons.png 0 -96"},load:function(textarea){var self=this,fm=this.fm,dfrd=$.Deferred(),cdn=fm.options.cdns.ace,start=function(){var editor,editorBase,mode,ta=$(textarea),taBase=ta.parent(),dialog=taBase.parent(),id=textarea.id+"_ace",ext=self.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),mimeMode={"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"};taBase.height(taBase.height()),ace.config.set("basePath",cdn),editorBase=$('<div id="'+id+'" style="width:100%; height:100%;"/>').text(ta.val()).insertBefore(ta.hide()),ta.data("ace",!0),(editor=ace.edit(id)).$blockScrolling=1/0,editor.setOptions({theme:"ace/theme/chrome",fontSize:"14px",wrap:!1}),ace.config.loadModule("ace/ext/modelist",(function(){"text"===(mode=ace.require("ace/ext/modelist").getModeForPath("/"+self.file.name).name)&&mimeMode[self.file.mime]&&(mode=mimeMode[self.file.mime]),taBase.prev().children(".elfinder-dialog-title").append(" ("+self.file.mime+" : "+mode.split(/[\/\\]/).pop()+")"),editor.setOptions({mode:"ace/mode/"+mode}),"resolved"===dfrd.state()&&dialog.trigger("resize")})),ace.config.loadModule("ace/ext/language_tools",(function(){ace.require("ace/ext/language_tools"),editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,highlightActiveLine:!0,highlightSelectedWord:!0,displayIndentGuides:!0,showPrintMargin:!0,printMarginColumn:80,showGutter:!0,highlightGutterLine:!0,selectionStyle:"text"})})),ace.config.loadModule("ace/ext/settings_menu",(function(){ace.require("ace/ext/settings_menu").init(editor)})),editor.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(editor){self.doSave()}}),editor.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(editor){self.doCancel()}}),editor.resize(),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(self.fm.i18n("TextArea")).button().on("click",(function(){ta.data("ace")?(ta.removeData("ace"),editorBase.hide(),ta.val(editor.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(ta.data("ace",!0),editorBase.show(),editor.setValue(ta.hide().val(),-1),editor.focus(),$(this).html(self.fm.i18n("TextArea")))}))).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",(function(){editor.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().appendTo($("#elfinder"))}))).prependTo(taBase.next()),self.trigger("Prepare",{node:textarea,editorObj:ace,instance:editor,opts:{}}),dfrd.resolve(editor)};return self.confObj.loader||(self.confObj.loader=$.Deferred(),self.fm.loadScript([cdn+"/ace.js"],(function(){self.confObj.loader.resolve()}),void 0,{obj:window,name:"ace"})),self.confObj.loader.done(start),dfrd},close:function(textarea,instance){instance&&instance.destroy()},save:function(textarea,instance){instance&&$(textarea).data("ace")&&(textarea.value=instance.session.getValue())},focus:function(textarea,instance){instance&&$(textarea).data("ace")&&instance.focus()},resize:function(textarea,instance,e,data){instance&&instance.resize()}},{setup:function(opts,fm){!fm.UA.ltIE10&&fm.options.cdns.codemirror||(this.disabled=!0)},info:{id:"codemirror",name:"CodeMirror",iconImg:"img/editor-icons.png 0 -176"},load:function(textarea){var fm=this.fm,cmUrl=fm.convAbsUrl(fm.options.cdns.codemirror),dfrd=$.Deferred(),self=this,start=function(CodeMirror){var ta=$(textarea),base=ta.parent(),editor,editorBase,opts,info,m,mode,spec;base.height(base.height()),opts={lineNumbers:!0,lineWrapping:!1,extraKeys:{"Ctrl-S":function(){self.doSave()},"Ctrl-Q":function(){self.doCancel()},"Ctrl-W":function(){self.doCancel()}}},self.trigger("Prepare",{node:textarea,editorObj:CodeMirror,instance:void 0,opts:opts}),editor=CodeMirror.fromTextArea(textarea,opts),dfrd.resolve(editor),info||(info=CodeMirror.findModeByMIME(self.file.mime)),!info&&(m=self.file.name.match(/.+\.([^.]+)$/))&&(info=CodeMirror.findModeByExtension(m[1])),info&&(CodeMirror.modeURL=useRequire?"codemirror/mode/%N/%N.min":cmUrl+"/mode/%N/%N.min.js",mode=info.mode,spec=info.mime,editor.setOption("mode",spec),CodeMirror.autoLoadMode(editor,mode),base.prev().children(".elfinder-dialog-title").append(" ("+spec+" : "+mode+")")),editorBase=$(editor.getWrapperElement()).css({padding:0,border:"none"}),ta.data("cm",!0),editorBase.height("100%"),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(self.fm.i18n("TextArea")).button().on("click",(function(){ta.data("cm")?(ta.removeData("cm"),editorBase.hide(),ta.val(editor.getValue()).show().trigger("focus"),$(this).text("CodeMirror")):(ta.data("cm",!0),editorBase.show(),editor.setValue(ta.hide().val()),editor.refresh(),editor.focus(),$(this).html(self.fm.i18n("TextArea")))}))).prependTo(base.next())};return self.confObj.loader||(self.confObj.loader=$.Deferred(),useRequire?(require.config({packages:[{name:"codemirror",location:cmUrl,main:"codemirror.min"}],map:{codemirror:{"codemirror/lib/codemirror":"codemirror"}}}),require(["codemirror","codemirror/addon/mode/loadmode.min","codemirror/mode/meta.min"],(function(CodeMirror){self.confObj.loader.resolve(CodeMirror)}))):self.fm.loadScript([cmUrl+"/codemirror.min.js"],(function(){self.fm.loadScript([cmUrl+"/addon/mode/loadmode.min.js",cmUrl+"/mode/meta.min.js"],(function(){self.confObj.loader.resolve(CodeMirror)}))}),{loadType:"tag"}),self.fm.loadCss(cmUrl+"/codemirror.css")),self.confObj.loader.done(start),dfrd},close:function(textarea,instance){instance&&instance.toTextArea()},save:function(textarea,instance){instance&&$(textarea).data("cm")&&(textarea.value=instance.getValue())},focus:function(textarea,instance){instance&&$(textarea).data("cm")&&instance.focus()},resize:function(textarea,instance,e,data){instance&&instance.refresh()}},{setup:function(opts,fm){!fm.UA.ltIE10&&fm.options.cdns.simplemde||(this.disabled=!0)},info:{id:"simplemde",name:"SimpleMDE",iconImg:"img/editor-icons.png 0 -80"},exts:["md"],load:function(textarea){var self=this,fm=this.fm,base=$(textarea).parent(),dfrd=$.Deferred(),cdn=fm.options.cdns.simplemde,start=function(SimpleMDE){var h=base.height(),delta=base.outerHeight(!0)-h+14,editor,editorBase,opts;textarea._setHeight=function(height){var h=height||base.height(),ctrH=0,areaH;return base.children(".editor-toolbar,.editor-statusbar").each((function(){ctrH+=$(this).outerHeight(!0)})),areaH=h-ctrH-delta,editorBase.height(areaH),editor.codemirror.refresh(),areaH},base.height(h),opts={element:textarea,autofocus:!0},self.trigger("Prepare",{node:textarea,editorObj:SimpleMDE,instance:void 0,opts:opts}),editor=new SimpleMDE(opts),dfrd.resolve(editor),(editorBase=$(editor.codemirror.getWrapperElement())).css("min-height","50px").children(".CodeMirror-scroll").css("min-height","50px"),textarea._setHeight(h)};return self.confObj.loader||(self.confObj.loader=$.Deferred(),self.fm.loadCss(cdn+"/simplemde.min.css"),useRequire?require([cdn+"/simplemde.min.js"],(function(SimpleMDE){self.confObj.loader.resolve(SimpleMDE)})):self.fm.loadScript([cdn+"/simplemde.min.js"],(function(){self.confObj.loader.resolve(SimpleMDE)}),{loadType:"tag"})),self.confObj.loader.done(start),dfrd},close:function(textarea,instance){instance&&instance.toTextArea(),instance=null},save:function(textarea,instance){instance&&(textarea.value=instance.value())},focus:function(textarea,instance){instance&&instance.codemirror.focus()},resize:function(textarea,instance,e,data){instance&&textarea._setHeight()}},{info:{id:"ckeditor",name:"CKEditor",iconImg:"img/editor-icons.png 0 0"},exts:["htm","html","xhtml"],setup:function(opts,fm){var confObj=this;fm.options.cdns.ckeditor?(this.ckeOpts={},opts.extraOptions&&(this.ckeOpts=Object.assign({},opts.extraOptions.ckeditor||{}),opts.extraOptions.managerUrl&&(this.managerUrl=opts.extraOptions.managerUrl))):this.disabled=!0},load:function(textarea){var self=this,fm=this.fm,dfrd=$.Deferred(),init=function(){var base=$(textarea).parent(),dlg=base.closest(".elfinder-dialog"),h=base.height(),reg=/([&?]getfile=)[^&]+/,loc=self.confObj.managerUrl||window.location.href.replace(/#.*$/,""),name="ckeditor",opts;reg.test(loc)?loc=loc.replace(reg,"$1"+name):loc+="?getfile="+name,base.height(h),opts={startupFocus:!0,fullPage:!0,allowedContent:!0,filebrowserBrowseUrl:loc,toolbarCanCollapse:!0,toolbarStartupExpanded:!fm.UA.Mobile,removePlugins:"resize",extraPlugins:"colorbutton,justify,docprops",on:{instanceReady:function(e){var editor=e.editor;editor.resize("100%",h),dlg.one("beforedommove."+fm.namespace,(function(){editor.destroy()})).one("dommove."+fm.namespace,(function(){self.load(textarea).done((function(editor){self.instance=editor}))})),dfrd.resolve(e.editor)}}},self.trigger("Prepare",{node:textarea,editorObj:CKEDITOR,instance:void 0,opts:opts}),CKEDITOR.replace(textarea.id,Object.assign(opts,self.confObj.ckeOpts)),CKEDITOR.on("dialogDefinition",(function(e){var dlg=e.data.definition.dialog;dlg.on("show",(function(e){fm.getUI().append($(".cke_dialog_background_cover")).append(this.getElement().$)})),dlg.on("hide",(function(e){$("body:first").append($(".cke_dialog_background_cover")).append(this.getElement().$)}))}))};return self.confObj.loader||(self.confObj.loader=$.Deferred(),window.CKEDITOR_BASEPATH=fm.options.cdns.ckeditor+"/",$.getScript(fm.options.cdns.ckeditor+"/ckeditor.js",(function(){self.confObj.loader.resolve()}))),self.confObj.loader.done(init),dfrd},close:function(textarea,instance){instance&&instance.destroy()},save:function(textarea,instance){instance&&(textarea.value=instance.getData())},focus:function(textarea,instance){instance&&instance.focus()},resize:function(textarea,instance,e,data){var self;instance&&"ready"===instance.status&&instance.resize("100%",$(textarea).parent().height())}},{info:{id:"ckeditor5",name:"CKEditor5",iconImg:"img/editor-icons.png 0 -16"},exts:["htm","html","xhtml"],html:'<div class="edit-editor-ckeditor5"></div>',setup:function(opts,fm){var confObj=this;fm.options.cdns.ckeditor5&&"function"==typeof window.Symbol&&"symbol"==typeof Symbol()?(confObj.ckeOpts={},opts.extraOptions&&(opts.extraOptions.ckeditor5Mode&&(confObj.ckeditor5Mode=opts.extraOptions.ckeditor5Mode),confObj.ckeOpts=Object.assign({},opts.extraOptions.ckeditor5||{}),confObj.ckeOpts.mode&&(confObj.ckeditor5Mode=confObj.ckeOpts.mode,delete confObj.ckeOpts.mode),opts.extraOptions.managerUrl&&(confObj.managerUrl=opts.extraOptions.managerUrl))):confObj.disabled=!0,fm.bind("destroy",(function(){confObj.editor=null}))},prepare:function(base,dialogOpts,file){$(base).height(base.editor.fm.getUI().height()-100)},init:function(id,file,data,fm){var m=data.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),header="",body="",footer="";this.css({width:"100%",height:"100%","box-sizing":"border-box"}),m?(header=m[1],body=m[2],footer=m[3]):body=data,this.data("data",{header:header,body:body,footer:footer})},load:function(editnode){var self=this,fm=this.fm,dfrd=$.Deferred(),mode=self.confObj.ckeditor5Mode||"inline",lang=("zh"===(l=fm.lang.toLowerCase().replace("_","-")).substr(0,2)&&"zh-cn"!==l&&(l="zh"),l),init=function(cEditor){var base=$(editnode).parent(),opts;base.height(fm.getUI().height()-100),opts=Object.assign({language:lang},self.confObj.ckeOpts),self.trigger("Prepare",{node:editnode,editorObj:cEditor,instance:void 0,opts:opts}),cEditor.create(editnode,opts).then((function(editor){var ckf=editor.commands.get("ckfinder"),fileRepo=editor.plugins.get("FileRepository"),prevVars={},isImage,insertImages;!editor.ui.view.toolbar||"classic"!==mode&&"decoupled-document"!==mode||$(editnode).closest(".elfinder-dialog").children(".ui-widget-header").append(editor.ui.view.toolbar.element),"classic"===mode&&$(editnode).closest(".elfinder-edit-editor").css("overflow","auto"),ckf&&(isImage=function(f){return f&&f.mime.match(/^image\//i)},insertImages=function(urls){var imgCmd;if(editor.commands.get("imageUpload").isEnabled)editor.execute("imageInsert",{source:urls});else{var ntf=editor.plugins.get("Notification"),i18=editor.locale.t;ntf.showWarning(i18("Could not insert image at the current position."),{title:i18("Inserting image failed"),namespace:"ckfinder"})}},ckf.execute=function(){var dlg=base.closest(".elfinder-dialog"),gf=fm.getCommand("getfile"),rever=function(){prevVars.hasVar&&(dlg.off("resize close",rever),gf.callback=prevVars.callback,gf.options.folders=prevVars.folders,gf.options.multiple=prevVars.multi,fm.commandMap.open=prevVars.open,prevVars.hasVar=!1)};dlg.trigger("togleminimize").one("resize close",rever),prevVars.callback=gf.callback,prevVars.folders=gf.options.folders,prevVars.multi=gf.options.multiple,prevVars.open=fm.commandMap.open,prevVars.hasVar=!0,gf.callback=function(files){var imgs=[];1!==files.length||"directory"!==files[0].mime?(fm.getUI("cwd").trigger("unselectall"),$.each(files,(function(i,f){isImage(f)?imgs.push(fm.convAbsUrl(f.url)):editor.execute("link",fm.convAbsUrl(f.url))})),imgs.length&&insertImages(imgs),dlg.trigger("togleminimize")):fm.one("open",(function(){fm.commandMap.open="getfile"})).getCommand("open").exec(files[0].hash)},gf.options.folders=!0,gf.options.multiple=!0,fm.commandMap.open="getfile",fm.toast({mode:"info",msg:fm.i18n("dblclickToSelect")})}),fileRepo.createUploadAdapter=function(loader){return new uploder(loader)},editor.setData($(editnode).data("data").body),fm.getUI().append($("body > div.ck-body")),$("div.ck-balloon-panel").css({"z-index":fm.getMaximizeCss().zIndex+1}),dfrd.resolve(editor)})).catch((function(error){fm.error(error)}))},uploder=function(loader){var upload=function(file,resolve,reject){fm.exec("upload",{files:[file]},void 0,fm.cwd().hash).done((function(data){data.added&&data.added.length?fm.url(data.added[0].hash,{async:!0}).done((function(url){resolve({default:fm.convAbsUrl(url)})})).fail((function(){reject("errFileNotFound")})):reject(fm.i18n(data.error?data.error:"errUpload"))})).fail((function(err){var error=fm.parseError(err);reject(fm.i18n(error?"userabort"===error?"errAbort":error:"errUploadNoFiles"))})).progress((function(data){loader.uploadTotal=data.total,loader.uploaded=data.progress}))};this.upload=function(){return new Promise((function(resolve,reject){loader.file instanceof Promise||loader.file&&"function"==typeof loader.file.then?loader.file.then((function(file){upload(file,resolve,reject)})):upload(loader.file,resolve,reject)}))},this.abort=function(){fm.getUI().trigger("uploadabort")}},loader,l;return self.confObj.editor?init(self.confObj.editor):(loader=$.Deferred(),self.fm.loadScript([fm.options.cdns.ckeditor5+"/"+mode+"/ckeditor.js"],(function(editor){editor||(editor=window.BalloonEditor||window.InlineEditor||window.ClassicEditor||window.DecoupledEditor),"en"!==fm.lang?self.fm.loadScript([fm.options.cdns.ckeditor5+"/"+mode+"/translations/"+lang+".js"],(function(obj){loader.resolve(editor)}),{tryRequire:!0,loadType:"tag",error:function(obj){lang="en",loader.resolve(editor)}}):loader.resolve(editor)}),{tryRequire:!0,loadType:"tag"}),loader.done((function(editor){self.confObj.editor=editor,init(editor)}))),dfrd},getContent:function(){var data=$(this).data("data");return data.header+data.body+data.footer},close:function(editnode,instance){instance&&instance.destroy()},save:function(editnode,instance){var elm=$(editnode),data=elm.data("data");instance&&(data.body=instance.getData(),elm.data("data",data))},focus:function(editnode,instance){$(editnode).trigger("focus")}},{info:{id:"tinymce",name:"TinyMCE",iconImg:"img/editor-icons.png 0 -64"},exts:["htm","html","xhtml"],setup:function(opts,fm){var confObj=this;fm.options.cdns.tinymce?(this.mceOpts={},opts.extraOptions?(this.uploadOpts=Object.assign({},opts.extraOptions.uploadOpts||{}),this.mceOpts=Object.assign({},opts.extraOptions.tinymce||{})):this.uploadOpts={}):this.disabled=!0},load:function(textarea){var self=this,fm=this.fm,dfrd=$.Deferred(),init=function(){var base=$(textarea).show().parent(),dlg=base.closest(".elfinder-dialog"),h=base.height(),delta=base.outerHeight(!0)-h,hideMceDlg=function(){var mceW;tinymce.activeEditor.windowManager.windows?(mceW=tinymce.activeEditor.windowManager.windows[0],mceDlg=$(mceW?mceW.getEl():void 0).hide(),mceCv=$("#mce-modal-block").hide()):mceDlg=$(".tox-dialog-wrap").hide()},showMceDlg=function(){mceCv&&mceCv.show(),mceDlg&&mceDlg.show()},tVer=tinymce.majorVersion,opts,mceDlg,mceCv;base.height(h),textarea._setHeight=function(height){if(tVer<5){var base=$(this).parent(),h=height||base.innerHeight(),ctrH=0,areaH;base.find(".mce-container-body:first").children(".mce-top-part,.mce-statusbar").each((function(){ctrH+=$(this).outerHeight(!0)})),areaH=h-ctrH-delta,base.find(".mce-edit-area iframe:first").height(areaH)}},opts={selector:"#"+textarea.id,resize:!1,plugins:"print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image media | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat",image_advtab:!0,init_instance_callback:function(editor){textarea._setHeight(h),dlg.one("beforedommove."+fm.namespace,(function(){tinymce.execCommand("mceRemoveEditor",!1,textarea.id)})).one("dommove."+fm.namespace,(function(){self.load(textarea).done((function(editor){self.instance=editor}))})),dfrd.resolve(editor)},file_picker_callback:function(callback,value,meta){var gf=fm.getCommand("getfile"),revar=function(){prevVars.hasVar&&(gf.callback=prevVars.callback,gf.options.folders=prevVars.folders,gf.options.multiple=prevVars.multi,fm.commandMap.open=prevVars.open,prevVars.hasVar=!1),dlg.off("resize close",revar),showMceDlg()},prevVars={};return prevVars.callback=gf.callback,prevVars.folders=gf.options.folders,prevVars.multi=gf.options.multiple,prevVars.open=fm.commandMap.open,prevVars.hasVar=!0,gf.callback=function(file){var url,info;"directory"!==file.mime?(url=fm.convAbsUrl(file.url),info=file.name+" ("+fm.formatSize(file.size)+")","file"==meta.filetype&&callback(url,{text:info,title:info}),"image"==meta.filetype&&callback(url,{alt:info}),"media"==meta.filetype&&callback(url),dlg.trigger("togleminimize")):fm.one("open",(function(){fm.commandMap.open="getfile"})).getCommand("open").exec(file.hash)},gf.options.folders=!0,gf.options.multiple=!1,fm.commandMap.open="getfile",hideMceDlg(),dlg.trigger("togleminimize").one("resize close",revar),fm.toast({mode:"info",msg:fm.i18n("dblclickToSelect")}),!1},images_upload_handler:function(blobInfo,success,failure){var file=blobInfo.blob(),err=function(e){var dlg=e.data.dialog||{};(dlg.hasClass("elfinder-dialog-error")||dlg.hasClass("elfinder-confirm-upload"))&&(hideMceDlg(),dlg.trigger("togleminimize").one("resize close",revert),fm.unbind("dialogopened",err))},revert=function(){dlg.off("resize close",revert),showMceDlg()},clipdata=!0;file.name&&(clipdata=void 0),fm.bind("dialogopened",err).exec("upload",Object.assign({files:[file],clipdata:clipdata},self.confObj.uploadOpts),void 0,fm.cwd().hash).done((function(data){data.added&&data.added.length?fm.url(data.added[0].hash,{async:!0}).done((function(url){showMceDlg(),success(fm.convAbsUrl(url))})).fail((function(){failure(fm.i18n("errFileNotFound"))})):failure(fm.i18n(data.error?data.error:"errUpload"))})).fail((function(err){var error=fm.parseError(err);error&&("errUnknownCmd"===error?error="errPerm":"userabort"===error&&(error="errAbort")),failure(fm.i18n(error||"errUploadNoFiles"))}))}},tVer>=5&&(opts.height="100%"),self.trigger("Prepare",{node:textarea,editorObj:tinymce,instance:void 0,opts:opts}),tinymce.init(Object.assign(opts,self.confObj.mceOpts))};return self.confObj.loader||(self.confObj.loader=$.Deferred(),self.fm.loadScript([fm.options.cdns.tinymce+(fm.options.cdns.tinymce.match(/\.js/)?"":"/tinymce.min.js")],(function(){self.confObj.loader.resolve()}),{loadType:"tag"})),self.confObj.loader.done(init),dfrd},close:function(textarea,instance){instance&&tinymce.execCommand("mceRemoveEditor",!1,textarea.id)},save:function(textarea,instance){instance&&instance.save()},focus:function(textarea,instance){instance&&instance.focus()},resize:function(textarea,instance,e,data){instance&&textarea._setHeight()}},{info:{id:"zohoeditor",name:"Zoho Editor",iconImg:"img/editor-icons.png 0 -32",cmdCheck:"ZohoOffice",preventGet:!0,hideButtons:!0,syncInterval:15e3,canMakeEmpty:!0,integrate:{title:"Zoho Office API",link:"https://www.zoho.com/officeapi/"}},mimes:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/rtf","text/html","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","application/vnd.sun.xml.calc","text/csv","text/tab-separated-values","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.oasis.opendocument.presentation","application/vnd.sun.xml.impress"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(opts,fm){(fm.UA.Mobile||fm.UA.ltIE8)&&(this.disabled=!0)},prepare:function(base,dialogOpts,file){var elfNode=base.editor.fm.getUI();$(base).height(elfNode.height()),dialogOpts.width=Math.max(dialogOpts.width||0,.8*elfNode.width())},init:function(id,file,dum,fm){var ta=this,ifm=$(this).hide(),uiToast=fm.getUI("toast"),spnr=$('<div class="elfinder-edit-spinner elfinder-edit-zohoeditor"/>').html('<span class="elfinder-spinner-text">'+fm.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(ifm.parent()),cdata=function(){var data="";return $.each(fm.customData,(function(key,val){data+="&"+encodeURIComponent(key)+"="+encodeURIComponent(val)})),data};$(ta).data("xhr",fm.request({data:{cmd:"editor",name:ta.editor.confObj.info.cmdCheck,method:"init","args[target]":file.hash,"args[lang]":fm.lang,"args[cdata]":cdata()},preventDefault:!0}).done((function(data){var opts;data.zohourl?(opts={css:{height:"100%"}},ta.editor.trigger("Prepare",{node:ta,editorObj:void 0,instance:ifm,opts:opts}),ifm.attr("src",data.zohourl).show().css(opts.css),data.warning&&(uiToast.appendTo(ta.closest(".ui-dialog")),fm.toast({msg:fm.i18n(data.warning),mode:"warning",timeOut:0,onHidden:function(){1===uiToast.children().length&&uiToast.appendTo(fm.getUI())},button:{text:"btnYes"}}))):(data.error&&fm.error(data.error),ta.elfinderdialog("destroy"))})).fail((function(error){error&&fm.error(error),ta.elfinderdialog("destroy")})).always((function(){spnr.remove()})))},load:function(){},getContent:function(){},save:function(){},beforeclose:iframeClose,close:function(ta){var fm=this.fm,xhr=$(ta).data("xhr");"pending"===xhr.state()&&xhr.reject()}},{info:{id:"ziparchive",name:"btnMount",iconImg:"img/toolbar.png 0 -416",cmdCheck:"ZipArchive",edit:function(file,editor){var fm=this,dfrd=$.Deferred();return fm.request({data:{cmd:"netmount",protocol:"ziparchive",host:file.hash,path:file.phash},notify:{type:"netmount",cnt:1,hideCnt:!0}}).done((function(data){var pdir;data.added&&data.added.length&&(data.added[0].phash&&(pdir=fm.file(data.added[0].phash))&&(pdir.dirs||(pdir.dirs=1,fm.change({changed:[pdir]}))),fm.one("netmountdone",(function(){fm.exec("open",data.added[0].hash),fm.one("opendone",(function(){data.toast&&fm.toast(data.toast)}))}))),dfrd.resolve()})).fail((function(error){dfrd.reject(error)})),dfrd}},mimes:["application/zip"],load:function(){},save:function(){}},{info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},mimes:["text/txt","text/csv"],load:function(textarea){this.trigger("Prepare",{node:textarea,editorObj:void 0,instance:void 0,opts:{}}),textarea.setSelectionRange&&textarea.setSelectionRange(0,0),$(textarea).trigger("focus").show()},save:function(){}},{info:{id:"onlineconvert",name:"Online Convert",iconImg:"img/editor-icons.png 0 -144",cmdCheck:"OnlineConvert",preventGet:!0,hideButtons:!0,single:!0,converter:!0,canMakeEmpty:!1,integrate:{title:"ONLINE-CONVERT.COM",link:"https://online-convert.com"}},mimes:["*"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(opts,fm){var mOpts=opts.extraOptions.onlineConvert||{maxSize:100,showLink:!0};mOpts.maxSize&&(this.info.maxSize=1048576*mOpts.maxSize),this.set=Object.assign({url:"https://%s.online-convert.com%s?external_url=",conv:{Archive:{"7Z":{},BZ2:{ext:"bz"},GZ:{},ZIP:{}},Audio:{MP3:{},OGG:{ext:"oga"},WAV:{},WMA:{},AAC:{},AIFF:{ext:"aif"},FLAC:{},M4A:{},MMF:{},OPUS:{ext:"oga"}},Document:{DOC:{},DOCX:{},HTML:{},ODT:{},PDF:{},PPT:{},PPTX:{},RTF:{},SWF:{},TXT:{}},eBook:{AZW3:{ext:"azw"},ePub:{},FB2:{ext:"xml"},LIT:{},LRF:{},MOBI:{},PDB:{},PDF:{},"PDF-eBook":{ext:"pdf"},TCR:{}},Hash:{Adler32:{},"Apache-htpasswd":{},Blowfish:{},CRC32:{},CRC32B:{},Gost:{},Haval128:{},MD4:{},MD5:{},RIPEMD128:{},RIPEMD160:{},SHA1:{},SHA256:{},SHA384:{},SHA512:{},Snefru:{},"Std-DES":{},Tiger128:{},"Tiger128-calculator":{},"Tiger128-converter":{},Tiger160:{},Tiger192:{},Whirlpool:{}},Image:{BMP:{},EPS:{ext:"ai"},GIF:{},EXR:{},ICO:{},JPG:{},PNG:{},SVG:{},TGA:{},TIFF:{ext:"tif"},WBMP:{},WebP:{}},Video:{"3G2":{},"3GP":{},AVI:{},FLV:{},HLS:{ext:"m3u8"},MKV:{},MOV:{},MP4:{},"MPEG-1":{ext:"mpeg"},"MPEG-2":{ext:"mpeg"},OGG:{ext:"ogv"},OGV:{},WebM:{},WMV:{},Android:{link:"/convert-video-for-%s",ext:"mp4"},Blackberry:{link:"/convert-video-for-%s",ext:"mp4"},DPG:{link:"/convert-video-for-%s",ext:"avi"},iPad:{link:"/convert-video-for-%s",ext:"mp4"},iPhone:{link:"/convert-video-for-%s",ext:"mp4"},iPod:{link:"/convert-video-for-%s",ext:"mp4"},"Nintendo-3DS":{link:"/convert-video-for-%s",ext:"avi"},"Nintendo-DS":{link:"/convert-video-for-%s",ext:"avi"},PS3:{link:"/convert-video-for-%s",ext:"mp4"},Wii:{link:"/convert-video-for-%s",ext:"avi"},Xbox:{link:"/convert-video-for-%s",ext:"wmv"}}},catExts:{Hash:"txt"},link:'<div class="elfinder-edit-onlineconvert-link"><a href="https://www.online-convert.com" target="_blank"><span class="elfinder-button-icon"></span>ONLINE-CONVERT.COM</a></div>',useTabs:!(!$.fn.tabs||fm.UA.iOS)},mOpts)},prepare:function(base,dialogOpts,file){var elfNode=base.editor.fm.getUI();$(base).height(elfNode.height()),dialogOpts.width=Math.max(dialogOpts.width||0,.8*elfNode.width())},init:function(id,file,dum,fm){var ta=this,confObj=ta.editor.confObj,set=confObj.set,uiToast=fm.getUI("toast"),idxs={},allowZip=fm.uploadMimeCheck("application/zip",file.phash),selfUrl=$("base").length?document.location.href.replace(/#.*$/,""):"",getExt=function(cat,con){var c;return set.catExts[cat]?set.catExts[cat]:set.conv[cat]&&(c=set.conv[cat][con])?(c.ext||con).toLowerCase():con.toLowerCase()},setOptions=function(cat,done){var type,dfdInit,dfd;dfdInit=void 0===confObj.api?fm.request({data:{cmd:"editor",name:"OnlineConvert",method:"init"},preventDefault:!0}):$.Deferred().resolve({api:confObj.api}),cat=cat.toLowerCase(),dfdInit.done((function(data){confObj.api=data.api,confObj.api&&(cat?type="?category="+cat:(type="",cat="all"),confObj.conversions||(confObj.conversions={}),(dfd=confObj.conversions[cat]?$.Deferred().resolve(confObj.conversions[cat]):$.getJSON("https://api2.online-convert.com/conversions"+type)).done((function(d){confObj.conversions[cat]=d,$.each(d,(function(i,o){btns[set.useTabs?"children":"find"](".onlineconvert-category-"+o.category).children(".onlineconvert-"+o.target).trigger("makeoption",o)})),done&&done()})))}))},btns=function(){var btns=$("<div/>").on("click","button",(function(){var b=$(this),opts=b.data("opts")||null,cat=b.closest(".onlineconvert-category").data("cname"),con=b.data("conv");!0===confObj.api?api({category:cat,convert:con,options:opts}):open(cat,con)})).on("change",(function(e){var t=$(e.target),p=t.parent(),b=t.closest(".elfinder-edit-onlineconvert-button").children("button:first"),o=b.data("opts")||{},v="boolean"===p.data("type")?t.is(":checked"):t.val(),reg;(e.stopPropagation(),v)&&("integer"===p.data("type")&&(v=parseInt(v)),p.data("pattern")&&(new RegExp(p.data("pattern")).test(v)||(requestAnimationFrame((function(){fm.error('"'+fm.escape(v)+'" is not match to "/'+fm.escape(p.data("pattern"))+'/"')})),v=null)));v?o[t.parent().data("optkey")]=v:delete o[p.data("optkey")],b.data("opts",o)})),ul=$("<ul/>"),oform=function(n,o){var f=$("<p/>").data("optkey",n).data("type",o.type),checked="",disabled="",nozip=!1,opts,btn,elm;return o.description&&f.attr("title",fm.i18n(o.description)),o.pattern&&f.data("pattern",o.pattern),f.append($("<span/>").text(fm.i18n(n)+" : ")),"boolean"===o.type?((o.default||(nozip="allow_multiple_outputs"===n&&!allowZip))&&(checked=" checked",nozip&&(disabled=" disabled"),(opts=(btn=this.children("button:first")).data("opts")||{})[n]=!0,btn.data("opts",opts)),f.append($('<input type="checkbox" value="true"'+checked+disabled+"/>"))):o.enum?(elm=$("<select/>").append($('<option value=""/>').text("Select...")),$.each(o.enum,(function(i,v){elm.append($('<option value="'+v+'"/>').text(v))})),f.append(elm)):f.append($('<input type="text" value=""/>')),f},makeOption=function(o){var elm=this,b=$('<span class="elfinder-button-icon elfinder-button-icon-preference"/>').on("click",(function(){f.toggle()})),f=$('<div class="elfinder-edit-onlinconvert-options"/>').hide();o.options&&$.each(o.options,(function(k,v){"download_password"!==k&&f.append(oform.call(elm,k,v))})),elm.append(b,f)},ts=+new Date,i=0;return confObj.ext2mime||(confObj.ext2mime=Object.assign(fm.arrayFlip(fm.mimeTypes),ext2mime)),$.each(set.conv,(function(t,c){var cname=t.toLowerCase(),id="elfinder-edit-onlineconvert-"+cname+ts,type=$('<div id="'+id+'" class="onlineconvert-category onlineconvert-category-'+cname+'"/>').data("cname",t),cext;$.each(c,(function(n,o){var nl=n.toLowerCase(),ext=getExt(t,n);confObj.ext2mime[ext]||(confObj.ext2mime[ext]="audio"===cname||"image"===cname||"video"===cname?cname+"/x-"+nl:"application/octet-stream"),fm.uploadMimeCheck(confObj.ext2mime[ext],file.phash)&&type.append($('<div class="elfinder-edit-onlineconvert-button onlineconvert-'+nl+'"/>').on("makeoption",(function(e,data){var elm=$(this);elm.children(".elfinder-button-icon-preference").length||makeOption.call(elm,data)})).append($("<button/>").text(n).data("conv",n)))})),type.children().length&&(ul.append($("<li/>").append($("<a/>").attr("href",selfUrl+"#"+id).text(t))),btns.append(type),idxs[cname]=i++)})),set.useTabs?btns.prepend(ul).tabs({beforeActivate:function(e,ui){setOptions(ui.newPanel.data("cname"))}}):$.each(set.conv,(function(t){var tl=t.toLowerCase();btns.append($('<fieldset class="onlineconvert-fieldset-'+tl+'"/>').append($("<legend/>").text(t)).append(btns.children(".onlineconvert-category-"+tl)))})),btns}(),ifm=$(this).hide(),select=$("<div/>").append(btns,$('<div class="elfinder-edit-onlineconvert-bottom-btn"/>').append($("<button/>").addClass(fm.UA.iOS?"elfinder-button-ios-multiline":"").html(fm.i18n("convertOn","Online-Convert.com")).on("click",(function(){open()}))),set.showLink?$(set.link):null).appendTo(ifm.parent().css({overflow:"auto"})),spnr=$('<div class="elfinder-edit-spinner elfinder-edit-onlineconvert"/>').hide().html('<span class="elfinder-spinner-text">'+fm.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(ifm.parent()),_url=null,url=function(){var onetime;return _url?$.Deferred().resolve(_url):(spnr.show(),fm.forExternalUrl(file.hash).done((function(url){_url=url})).fail((function(error){error&&fm.error(error),ta.elfinderdialog("destroy")})).always((function(){spnr.hide()})))},api=function(opts){$(ta).data("dfrd",url().done((function(url){select.fadeOut(),setStatus({info:"Start conversion request."}),fm.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[category]":opts.category.toLowerCase(),"args[convert]":opts.convert.toLowerCase(),"args[options]":JSON.stringify(opts.options),"args[source]":fm.convAbsUrl(url),"args[filename]":fm.splitFileExtention(file.name)[0]+"."+getExt(opts.category,opts.convert),"args[mime]":file.mime},preventDefault:!0}).done((function(data){checkRes(data.apires,opts.category,opts.convert)})).fail((function(error){error&&fm.error(error),ta.elfinderdialog("destroy")}))})))},checkRes=function(res,cat,con){var status,err=[];res&&res.id?"failed"===(status=res.status).code?(spnr.hide(),res.errors&&res.errors.length&&$.each(res.errors,(function(i,o){o.message&&err.push(o.message)})),fm.error(err.length?err:status.info),select.fadeIn()):"completed"===status.code?upload(res):(setStatus(status),setTimeout((function(){polling(res.id)}),1e3)):(uiToast.appendTo(ta.closest(".ui-dialog")),res.message&&fm.toast({msg:fm.i18n(res.message),mode:"error",timeOut:5e3,onHidden:function(){1===uiToast.children().length&&uiToast.appendTo(fm.getUI())}}),fm.toast({msg:fm.i18n("editorConvNoApi"),mode:"warning",timeOut:3e3,onHidden:function(){1===uiToast.children().length&&uiToast.appendTo(fm.getUI()),open(cat,con)}}))},setStatus=function(status){spnr.show().children(".elfinder-spinner-text").text(status.info)},polling=function(jobid){fm.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[jobid]":jobid},preventDefault:!0}).done((function(data){checkRes(data.apires)})).fail((function(error){error&&fm.error(error),ta.elfinderdialog("destroy")}))},upload=function(res){var output=res.output,id=res.id,url="";spnr.hide(),output&&output.length&&(ta.elfinderdialog("destroy"),$.each(output,(function(i,o){o.uri&&(url+=o.uri+"\n")})),fm.upload({target:file.phash,files:[url],type:"text",extraData:{contentSaveId:"OnlineConvert-"+res.id}}))},open=function(cat,con){var link;cat&&con?(link=set.conv[cat]&&set.conv[cat][con]&&set.conv[cat][con].link?set.conv[cat][con].link.replace("%s",con):"hash"===cat?"/"+con+"-generator":"/convert-to-"+con,link=set.url.replace("%s",cat).replace("%s",link)):link=set.url.replace("%s",mode+"-conversion").replace("%s",""),spnr.hide(),select.hide(),ifm.parent().css({overflow:fm.UA.iOS?"auto":"hidden"}),$(ta).data("dfrd",url().done((function(url){var opts;url?(opts={css:{height:"100%"}},ta.editor.trigger("Prepare",{node:ta,editorObj:void 0,instance:ifm,opts:opts}),url=link+encodeURIComponent(fm.convAbsUrl(url)),ifm.attr("src",url).show().css(opts.css).one("load",(function(){uiToast.appendTo(ta.closest(".ui-dialog")),fm.toast({msg:fm.i18n("editorConvNeedUpload"),mode:"info",timeOut:15e3,onHidden:function(){1===uiToast.children().length&&uiToast.appendTo(fm.getUI())},button:{text:"btnYes"}})}))):(data.error&&fm.error(data.error),ta.elfinderdialog("destroy"))})))},mode="document",cl,m;ifm.parent().addClass("overflow-scrolling-touch"),(m=file.mime.match(/^(audio|image|video)/))&&(mode=m[1]),set.useTabs?idxs[mode]&&btns.tabs("option","active",idxs[mode]):(cl=Object.keys(set.conv).length,$.each(set.conv,(function(t){if(t.toLowerCase()===mode)return setOptions(t,(function(){$.each(set.conv,(function(t0){t0.toLowerCase()!==mode&&setOptions(t0)}))})),!1;cl--})),cl||$.each(set.conv,(function(t){setOptions(t)})),ifm.parent().scrollTop(btns.children(".onlineconvert-fieldset-"+mode).offset().top))},load:function(){},getContent:function(){},save:function(){},beforeclose:iframeClose,close:function(ta){var fm=this.fm,dfrd=$(ta).data("dfrd");dfrd&&"pending"===dfrd.state()&&dfrd.reject()}}]}),window.elFinder);